(()=>{var e={};e.id=6240,e.ids=[6240],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},65529:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c});var r=s(67096),i=s(16132),o=s(37284),a=s.n(o),n=s(32564),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(t,l);let c=["",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,35622)),"/Users/delta/DMTS/src/app/users/page.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,75378)),"/Users/delta/DMTS/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/delta/DMTS/src/app/users/page.js"],u="/users/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/users/page",pathname:"/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},46398:(e,t,s)=>{Promise.resolve().then(s.bind(s,42984))},42984:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>page});var r=s(30784),i=s(9885),o=s(7501),a=s(70512),n=s(57114),l=s(21425),c=s(2343),d=s(43769),u=s(34802),p=s(63235),h=s(39283);s(446),s(99391),s(44348);var x=s(76878),g=s(55445),m=s(34301),j=s(42130),y=s(76713),S=s(35419),f=s(12918),G=s(18326),_=s(55772),C=s(41600),w=s(91210),b=s(87717),k=s(4266),N=s(45418),v=s(98014),T=s(30589),A=s(63631),D=s(98801),Z=s(5302),q=s(53263),P=s(9256),U=s(68602),z=s(47049),E=s(54997),O=s(6618),R=s(92210);let Components_CreateGroups=()=>{let[e,t]=(0,i.useState)([]),[s,o]=(0,i.useState)([]),[a,n]=(0,i.useState)([]),[l,c]=(0,i.useState)([]),d=(0,O.p)(),{isOpen:u,onOpen:p,onClose:h}=(0,x.q)(),[I,L]=(0,i.useState)(null),[H,M]=(0,i.useState)(!1),[$,F]=(0,i.useState)(!1);(0,i.useEffect)(()=>{getSites(),getGroups()},[]);let cancel=e=>{console.log(e),U.ZP.error("Click on No")},getGroups=async()=>{try{let e=await E.Z.get("/api/sites/getSiteGroups");n(e.data.message)}catch(e){console.log("err",e.message)}};(0,i.useEffect)(()=>{localStorage.setItem("targetKeys",JSON.stringify(e))},[e]);let handleCreateGroup=async()=>{M(!0);let s=X.filter(t=>e.includes(t.key)).map(e=>e.title);console.log("ininiddcd",e,s);let r=s.map(e=>e.slice(0,2)).join(""),i=[];for(let t=0;t<s.length;t++)i.push({siteId:e[t],pumpName:s[t]});console.log("FINAALLLL",i),await E.Z.post("/api/sites/createSiteGroup",{groupName:r,sites:i}),t([]),o([]),M(!1),d({description:"Group created successfully",status:"success",position:"top-right",duration:1e4,isClosable:!0}),getGroups()},getSites=async()=>{F(!0);try{let e=await E.Z.get("/api/sites/getAllSites");c(e.data.message),F(!1)}catch(e){console.error("Error fetching sites:",e)}},X=l.map(e=>({key:e._id,title:e.pumpName,description:e.description})),handleDeleteGroup=async e=>{try{await E.Z.post("/api/sites/deleteGroup",{groupId:e}),d({description:"Group deleted successfully",status:"success",position:"top-right",duration:1e4,isClosable:!0}),getGroups()}catch(e){console.error("Error deleting group:",e),d({description:"Error deleting group",status:"error",position:"top-right",duration:1e4,isClosable:!0})}finally{h()}};X.filter(e=>Number(e.key)>10).map(e=>e.key);let handleShowSites=e=>{L(e),p()};return(0,r.jsxs)(g.Z,{children:[r.jsx(m.O,{bg:"teal.500",borderBottomWidth:"1px",borderColor:"teal.600",color:"white",textAlign:"center",padding:"4",children:r.jsx(j.X,{size:"md",textTransform:"uppercase",children:"Create Groups"})}),r.jsx(y.e,{children:$?r.jsx(R.Z,{}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(j.X,{mb:5,size:"sm",textTransform:"uppercase",children:"Create Group"}),r.jsx(P.Z,{dataSource:X,titles:["Available","Groupped"],targetKeys:e,selectedKeys:s,onChange:(e,s,r)=>{t(e)},onSelectChange:(e,t)=>{o([...e,...t])},listStyle:{width:"100%",height:350},render:e=>e.title,showSearch:{filter:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase())}}),r.jsx(S.z,{mt:5,colorScheme:"teal",isLoading:H,onClick:handleCreateGroup,children:"Create Group"}),r.jsx(f.i,{mt:7}),r.jsx(j.X,{mt:6,size:"xs",textTransform:"uppercase",children:"Group List"}),(0,r.jsxs)(G.i,{variant:"simple",mt:4,children:[r.jsx("thead",{children:(0,r.jsxs)(_.Tr,{children:[r.jsx(C.Th,{children:"Index"}),r.jsx(C.Th,{children:"GroupName"}),r.jsx(C.Th,{children:"Sites"}),r.jsx(C.Th,{children:"Created At"}),r.jsx(C.Th,{children:"Action"})]})}),r.jsx(w.p,{children:a.map((e,t)=>(0,r.jsxs)(_.Tr,{children:[r.jsx(b.Td,{children:t+1}),r.jsx(b.Td,{children:e.groupName}),r.jsx(b.Td,{children:r.jsx(k.u,{label:e.sites.join(", "),placement:"right-end",children:r.jsx("span",{children:`${e.sites.length} sites`})})}),r.jsx(b.Td,{children:new Date(e.creationDate).toLocaleString()}),(0,r.jsxs)(b.Td,{children:[r.jsx(S.z,{colorScheme:"teal",size:"sm",onClick:()=>handleShowSites(e),children:"Show Sites"}),r.jsx(z.Z,{title:"Delete the task",description:"Are you sure to delete this task?",onConfirm:()=>handleDeleteGroup(e._id),onCancel:cancel,okText:"Delete",cancelText:"No",children:r.jsx(S.z,{size:"sm",ml:2,colorScheme:"red",children:"Delete Group"})})]})]},e._id))})]}),I&&(0,r.jsxs)(N.u_,{isOpen:u,onClose:h,children:[r.jsx(v.Z,{}),(0,r.jsxs)(T.h,{children:[r.jsx(A.x,{children:`Sites for Group: ${I.groupName}`}),r.jsx(D.o,{}),r.jsx(Z.f,{children:r.jsx("ul",{style:{listStyleType:"none",padding:0},children:I.sites.map((e,t)=>r.jsx("li",{children:`${t+1}. ${e.pumpName}`},e.siteId))})}),r.jsx(q.m,{children:r.jsx(S.z,{colorScheme:"teal",onClick:h,children:"Close"})})]})]})]})})]})};var I=s(13214),L=s(53275),H=s(34728),M=s(84887),$=s(72442);let{Option:F}=I.default,Components_AssignGroups=()=>{let e=(0,O.p)(),[t,s]=(0,i.useState)([]),[o,a]=(0,i.useState)([]),[n,l]=(0,i.useState)(1),[c,d]=(0,i.useState)(null),[u,p]=(0,i.useState)({}),[h,x]=(0,i.useState)(!1),[f,G]=(0,i.useState)(!1),[_,C]=(0,i.useState)(null),[w,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{getGroups()},[]);let getGroups=async()=>{b(!0);try{let e=await E.Z.get("/api/sites/getSiteGroups");a(e.data.message),b(!0)}catch(e){console.log("err",e.message)}};(0,i.useEffect)(()=>{getUsers()},[n]);let getUsers=async()=>{b(!0);try{let e=await E.Z.get("/api/user/getUserWithGroups",{params:{page:n}});s(e.data.message),b(!1)}catch(e){console.log(e.message)}},assignGroup=async t=>{try{let s=u[t._id]||[],r=s.map(e=>({groupId:e,groupName:o.find(t=>t._id===e)?.groupName||""})),i={userId:t._id,groups:r},a=await E.Z.post("/api/sites/assignGroup",i);"Some Groups Are Already Assigned"==a.data.message?e({title:"Whoops!",position:"top-right",description:"Some groups are already assigned to the user!",status:"warning",duration:"3000"}):e({title:"Success!",position:"top-right",description:"Groups have been assigned successfully",status:"success",duration:"3000"}),p(e=>{let s={...e};return s[t._id]=[],s}),console.log("INFOO",a)}catch(t){e({title:"Error occurred",description:`${t.message}`,position:"top-right",status:"danger",position:"top-right",duration:"3000"}),console.log("ERROR",t.message)}getUsers()},deleteGroup=async(t,s)=>{try{await E.Z.post("/api/sites/unassignGroup",{userId:t,groupId:s}),e({title:"Success!",description:"Group has been deleted successfully",position:"top-right",status:"success",duration:"3000"}),getUsers()}catch(t){e({title:"Error occurred",position:"top-right",description:`${t.message}`,status:"danger",position:"top-right",duration:"3000"}),console.log("ERROR",t.message)}},showDeleteConfirmation=(e,t)=>{C({userId:e,groupId:t}),G(!0)},handleDeleteConfirmation=async()=>{if(_){let{userId:e,groupId:t}=_;await deleteGroup(e,t),C(null),G(!1)}},k=[{title:"No",dataIndex:"index",key:"index",render:(e,t,s)=>(n-1)*10+s+1},{title:"Operator Name",dataIndex:"OperatorName",key:"OperatorName"},{title:"Assigned Groups",dataIndex:"assignedGroups",key:"assignedGroups",render:(e,t)=>r.jsx(r.Fragment,{children:t.assignedGroups.map(e=>r.jsx("span",{style:{marginRight:"8px"},children:(0,r.jsxs)(S.z,{size:"sm",variant:"solid",colorScheme:"teal",onClick:()=>showDeleteConfirmation(t._id,e.groupId),children:[e.groupName,r.jsx(H.Z,{})]})},e._id))})},{title:"Assign Group",key:"assignGroup",render:(e,t)=>(0,r.jsxs)($.default,{size:"middle",children:[r.jsx(I.default,{mode:"multiple",style:{width:"150px"},placeholder:"Select groups",value:u[t._id],onChange:e=>p({...u,[t._id]:e}),children:o.map(e=>r.jsx(F,{value:e._id,children:e.groupName},e._id))}),r.jsx(S.z,{onClick:()=>assignGroup(t),children:"Go"})]})}];return(0,r.jsxs)(r.Fragment,{children:[r.jsx(L.Z,{title:"Confirm Deletion",visible:f,onOk:handleDeleteConfirmation,onCancel:()=>{C(null),G(!1)},okText:"Yes",cancelText:"No",children:"Are you sure you want to delete this group?"}),(0,r.jsxs)(g.Z,{children:[r.jsx(m.O,{bg:"teal.500",borderBottomWidth:"1px",borderColor:"teal.600",color:"white",textAlign:"center",padding:"4",children:r.jsx(j.X,{size:"md",textTransform:"uppercase",children:"Assign Groups"})}),w?r.jsx(R.Z,{}):r.jsx(y.e,{children:r.jsx(M.Z,{dataSource:t,columns:k,pagination:{pageSize:10,current:n,onChange:e=>l(e)}})})]})]})};var X=s(32355),W=s(79397),B=s(57560);let Components_UserHistoryAndReports=()=>{let[e,t]=(0,i.useState)([]),[s,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{getUserHistoryReports()},[]);let getUserHistoryReports=async()=>{o(!0);try{let e=await E.Z.get("/api/sites/getUserSiteHistoryReport");t(e.data.message),o(!1)}catch(e){console.log(e.message)}},a=[...new Set(e.map(e=>e.userName))],n=[{title:"Group Name",dataIndex:"groupName",key:"groupName"},{title:"User Name",dataIndex:"userName",key:"userName",filters:a.map(e=>({text:e,value:e})),onFilter:(e,t)=>0===t.userName.indexOf(e)},{title:"Status",dataIndex:"status",key:"status"},{title:"Creation Date",dataIndex:"creationDate",key:"creationDate",render:(e,t)=>new Date(t.creationDate).toLocaleString()}];return(0,r.jsxs)(g.Z,{children:[r.jsx(m.O,{bg:"teal.500",borderBottomWidth:"1px",borderColor:"teal.600",color:"white",textAlign:"center",padding:"4",children:r.jsx(j.X,{size:"md",textTransform:"uppercase",children:"User History and Reports"})}),r.jsx(y.e,{children:s?r.jsx(R.Z,{}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(M.Z,{dataSource:e,columns:n}),r.jsx(X.k,{justify:"flex-start",position:"absolute",bottom:"4",left:"4",children:r.jsx(S.z,{onClick:()=>{let t=e.map(e=>({"Group Name":e.groupName,"User Name":e.userName,Status:e.status,"Creation Date":new Date(e.creationDate).toLocaleString()})),s=B.P6.json_to_sheet(t),r=B.P6.book_new();B.P6.book_append_sheet(r,s,"UserHistoryReports"),B.NC(r,"UserHistoryReports.xlsx")},colorScheme:"teal",leftIcon:r.jsx(W._,{}),children:"Export to Excel"})})]})})]})},{Header:K,Content:J,Footer:Y,Sider:Q}=o.default,page=()=>{(0,n.useRouter)();let[e,t]=(0,i.useState)(1),[s,x]=(0,i.useState)(!1),{token:{colorBgContainer:g}}=a.Z.useToken(),m=(0,l.ff)(["red.50","teal.50","blue.50"],["red.900","teal.900","blue.900"]),[j,y]=(0,i.useState)(0);return m[j],r.jsx(o.default,{style:{minHeight:"100vh",width:"100%",marginTop:"20px"},children:r.jsx(o.default,{children:r.jsx(J,{children:(0,r.jsxs)(c.m,{isManual:!0,mt:2,ml:.5,variant:"enclosed",children:[(0,r.jsxs)(d.t,{children:[r.jsx(u.O,{_selected:{color:"white",bg:"teal.500"},onClick:()=>t(1),children:"Create Groups"}),r.jsx(u.O,{_selected:{color:"white",bg:"teal.500"},onClick:()=>t(2),children:"Assign Groups"}),r.jsx(u.O,{_selected:{color:"white",bg:"teal.500"},onClick:()=>t(3),children:"User History And Reports"})]}),(0,r.jsxs)(p.n,{children:[r.jsx(h.x,{children:1==e&&r.jsx(Components_CreateGroups,{})}),r.jsx(h.x,{children:2==e&&r.jsx(Components_AssignGroups,{})}),r.jsx(h.x,{children:3==e&&r.jsx(Components_UserHistoryAndReports,{})})]})]})})})})}},35622:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>a,__esModule:()=>o,default:()=>l});var r=s(95153);let i=(0,r.createProxy)(String.raw`/Users/delta/DMTS/src/app/users/page.js`),{__esModule:o,$$typeof:a}=i,n=i.default,l=n}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[6126,9760,1323,4933,1915,9265,9903,278,2189,7109,5526],()=>__webpack_exec__(65529));module.exports=s})();