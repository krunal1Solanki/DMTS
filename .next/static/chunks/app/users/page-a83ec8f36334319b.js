(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{20067:function(){},72061:function(){},64721:function(e,t,s){Promise.resolve().then(s.bind(s,77360))},77360:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return page}});var r=s(57437),o=s(2265),i=s(2762),a=s(94854),n=s(24033),l=s(85035),c=s(51791),d=s(98386),u=s(93628),p=s(42226),h=s(15650);s(26281),s(87347),s(22086);var g=s(88402),x=s(16988),m=s(13266),j=s(39933),S=s(53494),y=s(71504),f=s(85465),C=s(10056),G=s(52736),N=s(17885),k=s(97464),w=s(32527),_=s(80181),b=s(30954),T=s(76526),Z=s(72952),A=s(3391),D=s(81629),O=s(4159),v=s(88610),z=s(73988),E=s(33116),R=s(63477),I=s(92173),U=s(20678),L=s(5242),Components_CreateGroups=()=>{let[e,t]=(0,o.useState)([]),[s,i]=(0,o.useState)([]),[a,n]=(0,o.useState)([]),[l,c]=(0,o.useState)([]),d=(0,U.p)(),{isOpen:u,onOpen:p,onClose:h}=(0,g.q)(),[H,F]=(0,o.useState)(null),[P,W]=(0,o.useState)(!1),[X,B]=(0,o.useState)(!1);(0,o.useEffect)(()=>{getSites(),getGroups()},[]);let cancel=e=>{console.log(e),E.ZP.error("Click on No")},getGroups=async()=>{try{let e=await I.Z.get("/api/sites/getSiteGroups");n(e.data.message)}catch(e){console.log("err",e.message)}};(0,o.useEffect)(()=>{localStorage.setItem("targetKeys",JSON.stringify(e))},[e]);let handleCreateGroup=async()=>{W(!0);let s=K.filter(t=>e.includes(t.key)).map(e=>e.title);console.log("ininiddcd",e,s);let r=s.map(e=>e.slice(0,2)).join(""),o=[];for(let t=0;t<s.length;t++)o.push({siteId:e[t],pumpName:s[t]});console.log("FINAALLLL",o),await I.Z.post("/api/sites/createSiteGroup",{groupName:r,sites:o}),t([]),i([]),W(!1),d({description:"Group created successfully",status:"success",position:"top-right",duration:1e4,isClosable:!0}),getGroups()},getSites=async()=>{B(!0);try{let e=await I.Z.get("/api/sites/getAllSites");c(e.data.message),B(!1)}catch(e){console.error("Error fetching sites:",e)}},K=l.map(e=>({key:e._id,title:e.pumpName,description:e.description})),handleDeleteGroup=async e=>{try{await I.Z.post("/api/sites/deleteGroup",{groupId:e}),d({description:"Group deleted successfully",status:"success",position:"top-right",duration:1e4,isClosable:!0}),getGroups()}catch(e){console.error("Error deleting group:",e),d({description:"Error deleting group",status:"error",position:"top-right",duration:1e4,isClosable:!0})}finally{h()}};K.filter(e=>Number(e.key)>10).map(e=>e.key);let handleShowSites=e=>{F(e),p()};return(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(m.O,{bg:"teal.500",borderBottomWidth:"1px",borderColor:"teal.600",color:"white",textAlign:"center",padding:"4",children:(0,r.jsx)(j.X,{size:"md",textTransform:"uppercase",children:"Create Groups"})}),(0,r.jsx)(S.e,{children:X?(0,r.jsx)(L.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.X,{mb:5,size:"sm",textTransform:"uppercase",children:"Create Group"}),(0,r.jsx)(z.Z,{dataSource:K,titles:["Available","Groupped"],targetKeys:e,selectedKeys:s,onChange:(e,s,r)=>{t(e)},onSelectChange:(e,t)=>{i([...e,...t])},listStyle:{width:"100%",height:350},render:e=>e.title,showSearch:{filter:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase())}}),(0,r.jsx)(y.z,{mt:5,colorScheme:"teal",isLoading:P,onClick:handleCreateGroup,children:"Create Group"}),(0,r.jsx)(f.i,{mt:7}),(0,r.jsx)(j.X,{mt:6,size:"xs",textTransform:"uppercase",children:"Group List"}),(0,r.jsxs)(C.i,{variant:"simple",mt:4,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)(G.Tr,{children:[(0,r.jsx)(N.Th,{children:"Index"}),(0,r.jsx)(N.Th,{children:"GroupName"}),(0,r.jsx)(N.Th,{children:"Sites"}),(0,r.jsx)(N.Th,{children:"Created At"}),(0,r.jsx)(N.Th,{children:"Action"})]})}),(0,r.jsx)(k.p,{children:a.map((e,t)=>(0,r.jsxs)(G.Tr,{children:[(0,r.jsx)(w.Td,{children:t+1}),(0,r.jsx)(w.Td,{children:e.groupName}),(0,r.jsx)(w.Td,{children:(0,r.jsx)(_.u,{label:e.sites.join(", "),placement:"right-end",children:(0,r.jsx)("span",{children:"".concat(e.sites.length," sites")})})}),(0,r.jsx)(w.Td,{children:new Date(e.creationDate).toLocaleString()}),(0,r.jsxs)(w.Td,{children:[(0,r.jsx)(y.z,{colorScheme:"teal",size:"sm",onClick:()=>handleShowSites(e),children:"Show Sites"}),(0,r.jsx)(R.Z,{title:"Delete the task",description:"Are you sure to delete this task?",onConfirm:()=>handleDeleteGroup(e._id),onCancel:cancel,okText:"Delete",cancelText:"No",children:(0,r.jsx)(y.z,{size:"sm",ml:2,colorScheme:"red",children:"Delete Group"})})]})]},e._id))})]}),H&&(0,r.jsxs)(b.u_,{isOpen:u,onClose:h,children:[(0,r.jsx)(T.Z,{}),(0,r.jsxs)(Z.h,{children:[(0,r.jsx)(A.x,{children:"Sites for Group: ".concat(H.groupName)}),(0,r.jsx)(D.o,{}),(0,r.jsx)(O.f,{children:(0,r.jsx)("ul",{style:{listStyleType:"none",padding:0},children:H.sites.map((e,t)=>(0,r.jsx)("li",{children:"".concat(t+1,". ").concat(e.pumpName)},e.siteId))})}),(0,r.jsx)(v.m,{children:(0,r.jsx)(y.z,{colorScheme:"teal",onClick:h,children:"Close"})})]})]})]})})]})},H=s(45623),F=s(33071),P=s(55843),W=s(68939),X=s(80338);let{Option:B}=H.default;var Components_AssignGroups=()=>{let e=(0,U.p)(),[t,s]=(0,o.useState)([]),[i,a]=(0,o.useState)([]),[n,l]=(0,o.useState)(1),[c,d]=(0,o.useState)(null),[u,p]=(0,o.useState)({}),[h,g]=(0,o.useState)(!1),[f,C]=(0,o.useState)(!1),[G,N]=(0,o.useState)(null),[k,w]=(0,o.useState)(!1);(0,o.useEffect)(()=>{getGroups()},[]);let getGroups=async()=>{w(!0);try{let e=await I.Z.get("/api/sites/getSiteGroups");a(e.data.message),w(!0)}catch(e){console.log("err",e.message)}};(0,o.useEffect)(()=>{getUsers()},[n]);let getUsers=async()=>{w(!0);try{let e=await I.Z.get("/api/user/getUserWithGroups",{params:{page:n}});s(e.data.message),w(!1)}catch(e){console.log(e.message)}},assignGroup=async t=>{try{let s=u[t._id]||[],r=s.map(e=>{var t;return{groupId:e,groupName:(null===(t=i.find(t=>t._id===e))||void 0===t?void 0:t.groupName)||""}}),o={userId:t._id,groups:r},a=await I.Z.post("/api/sites/assignGroup",o);"Some Groups Are Already Assigned"==a.data.message?e({title:"Whoops!",position:"top-right",description:"Some groups are already assigned to the user!",status:"warning",duration:"3000"}):e({title:"Success!",position:"top-right",description:"Groups have been assigned successfully",status:"success",duration:"3000"}),p(e=>{let s={...e};return s[t._id]=[],s}),console.log("INFOO",a)}catch(t){e({title:"Error occurred",description:"".concat(t.message),position:"top-right",status:"danger",position:"top-right",duration:"3000"}),console.log("ERROR",t.message)}getUsers()},deleteGroup=async(t,s)=>{try{await I.Z.post("/api/sites/unassignGroup",{userId:t,groupId:s}),e({title:"Success!",description:"Group has been deleted successfully",position:"top-right",status:"success",duration:"3000"}),getUsers()}catch(t){e({title:"Error occurred",position:"top-right",description:"".concat(t.message),status:"danger",position:"top-right",duration:"3000"}),console.log("ERROR",t.message)}},showDeleteConfirmation=(e,t)=>{N({userId:e,groupId:t}),C(!0)},handleDeleteConfirmation=async()=>{if(G){let{userId:e,groupId:t}=G;await deleteGroup(e,t),N(null),C(!1)}},_=[{title:"No",dataIndex:"index",key:"index",render:(e,t,s)=>(n-1)*10+s+1},{title:"Operator Name",dataIndex:"OperatorName",key:"OperatorName"},{title:"Assigned Groups",dataIndex:"assignedGroups",key:"assignedGroups",render:(e,t)=>(0,r.jsx)(r.Fragment,{children:t.assignedGroups.map(e=>(0,r.jsx)("span",{style:{marginRight:"8px"},children:(0,r.jsxs)(y.z,{size:"sm",variant:"solid",colorScheme:"teal",onClick:()=>showDeleteConfirmation(t._id,e.groupId),children:[e.groupName,(0,r.jsx)(P.Z,{})]})},e._id))})},{title:"Assign Group",key:"assignGroup",render:(e,t)=>(0,r.jsxs)(X.default,{size:"middle",children:[(0,r.jsx)(H.default,{mode:"multiple",style:{width:"150px"},placeholder:"Select groups",value:u[t._id],onChange:e=>p({...u,[t._id]:e}),children:i.map(e=>(0,r.jsx)(B,{value:e._id,children:e.groupName},e._id))}),(0,r.jsx)(y.z,{onClick:()=>assignGroup(t),children:"Go"})]})}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Z,{title:"Confirm Deletion",visible:f,onOk:handleDeleteConfirmation,onCancel:()=>{N(null),C(!1)},okText:"Yes",cancelText:"No",children:"Are you sure you want to delete this group?"}),(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(m.O,{bg:"teal.500",borderBottomWidth:"1px",borderColor:"teal.600",color:"white",textAlign:"center",padding:"4",children:(0,r.jsx)(j.X,{size:"md",textTransform:"uppercase",children:"Assign Groups"})}),k?(0,r.jsx)(L.Z,{}):(0,r.jsx)(S.e,{children:(0,r.jsx)(W.Z,{dataSource:t,columns:_,pagination:{pageSize:10,current:n,onChange:e=>l(e)}})})]})]})},K=s(26621),q=s(83259),J=s(7504),Components_UserHistoryAndReports=()=>{let[e,t]=(0,o.useState)([]),[s,i]=(0,o.useState)(!1);(0,o.useEffect)(()=>{getUserHistoryReports()},[]);let getUserHistoryReports=async()=>{i(!0);try{let e=await I.Z.get("/api/sites/getUserSiteHistoryReport");t(e.data.message),i(!1)}catch(e){console.log(e.message)}},a=[...new Set(e.map(e=>e.userName))],n=[{title:"Group Name",dataIndex:"groupName",key:"groupName"},{title:"User Name",dataIndex:"userName",key:"userName",filters:a.map(e=>({text:e,value:e})),onFilter:(e,t)=>0===t.userName.indexOf(e)},{title:"Status",dataIndex:"status",key:"status"},{title:"Creation Date",dataIndex:"creationDate",key:"creationDate",render:(e,t)=>new Date(t.creationDate).toLocaleString()}];return(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(m.O,{bg:"teal.500",borderBottomWidth:"1px",borderColor:"teal.600",color:"white",textAlign:"center",padding:"4",children:(0,r.jsx)(j.X,{size:"md",textTransform:"uppercase",children:"User History and Reports"})}),(0,r.jsx)(S.e,{children:s?(0,r.jsx)(L.Z,{}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(W.Z,{dataSource:e,columns:n}),(0,r.jsx)(K.k,{justify:"flex-start",position:"absolute",bottom:"4",left:"4",children:(0,r.jsx)(y.z,{onClick:()=>{let t=e.map(e=>({"Group Name":e.groupName,"User Name":e.userName,Status:e.status,"Creation Date":new Date(e.creationDate).toLocaleString()})),s=J.P6.json_to_sheet(t),r=J.P6.book_new();J.P6.book_append_sheet(r,s,"UserHistoryReports"),J.NC(r,"UserHistoryReports.xlsx")},colorScheme:"teal",leftIcon:(0,r.jsx)(q._,{}),children:"Export to Excel"})})]})})]})};let{Header:M,Content:Y,Footer:Q,Sider:V}=i.default;var page=()=>{(0,n.useRouter)();let[e,t]=(0,o.useState)(1),[s,g]=(0,o.useState)(!1),{token:{colorBgContainer:x}}=a.Z.useToken(),m=(0,l.ff)(["red.50","teal.50","blue.50"],["red.900","teal.900","blue.900"]),[j,S]=(0,o.useState)(0);return m[j],(0,r.jsx)(i.default,{style:{minHeight:"100vh",width:"100%",marginTop:"20px"},children:(0,r.jsx)(i.default,{children:(0,r.jsx)(Y,{children:(0,r.jsxs)(c.m,{isManual:!0,mt:2,ml:.5,variant:"enclosed",children:[(0,r.jsxs)(d.t,{children:[(0,r.jsx)(u.O,{_selected:{color:"white",bg:"teal.500"},onClick:()=>t(1),children:"Create Groups"}),(0,r.jsx)(u.O,{_selected:{color:"white",bg:"teal.500"},onClick:()=>t(2),children:"Assign Groups"}),(0,r.jsx)(u.O,{_selected:{color:"white",bg:"teal.500"},onClick:()=>t(3),children:"User History And Reports"})]}),(0,r.jsxs)(p.n,{children:[(0,r.jsx)(h.x,{children:1==e&&(0,r.jsx)(Components_CreateGroups,{})}),(0,r.jsx)(h.x,{children:2==e&&(0,r.jsx)(Components_AssignGroups,{})}),(0,r.jsx)(h.x,{children:3==e&&(0,r.jsx)(Components_UserHistoryAndReports,{})})]})]})})})})}}},function(e){e.O(0,[425,57,77,209,94,697,115,507,861,351,662,971,472,744],function(){return e(e.s=64721)}),_N_E=e.O()}]);